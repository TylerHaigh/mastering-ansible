---
# tasks file for mysql

- name: Install the libselinux-python package
  yum:
    name: libselinux-python
    state: present

- name: install tools
  yum:
    name: MySQL-python
    state: present
    update_cache: yes

- name: download mysql server rpm package
  yum:
    name: https://dev.mysql.com/get/mysql80-community-release-el6-2.noarch.rpm
    # state: present
    # update_cache: yes

- name: confirm rpm package was added
  shell: yum repolist all | grep mysql


# installs mysqld, mysql, mysqldump
- name: install mysql server
  yum:
    name: mysql-community-server
    state: present
    update_cache: yes

- name: ensure mysql is listening on all ports
  lineinfile:
    dest: /etc/my.cnf
    regexp: ^bind-address
    line: "bind-address = 0.0.0.0"
  notify: restart mysql

# Always give the server a chance to reconfigure itself
# before restarting
- name: ensure mysql started
  service:
    name: mysqld
    state: started
    enabled: yes

# at this point, you need to manually log into the server and run the commands listed in ../utils/mysql-commands.sh
# to change the root mysql password

- name: create demo database
  mysql_db:
    name: demo
    state: present
    login_host: localhost
    login_user: tyler
    login_password: tylerlocalhost

# Broken: https://github.com/ansible/ansible/pull/52278
# - name: create demo database user
#   mysql_user:
#     name: demo
#     password: demolocalhost
#     priv: 'demo.*:ALL'
#     # host: localhost
#     state: present
#     login_host: localhost
#     login_user: tyler
#     login_password: tylerlocalhost