---
# tasks file for nginx


- name: install nginx

  # https://docs.ansible.com/ansible/latest/modules/yum_module.html
  yum:
    name: nginx

    # "present" and "installed" will simply ensure that a desired package is installed.
    # "latest" will update the specified package if it's not of the latest available version.
    state: present

    # Enable a repo for the install/update operation.
    # These repos will not persist beyond the transaction
    enablerepo: epel

    # Force yum to check if cache is out of date and redownload if needed.
    # Has an effect only if state is present or latest.
    update_cache: yes


- name: configure nginx site
  template:
    src: nginx.conf.j2
    dest: /etc/nginx/conf.d/demo.conf
    mode: 0644
  notify: restart nginx


# Give Ansible a chance to update the config
# before starting the service  
- name: ensure nginx has started
  service:
    name: nginx
    state: started
    enabled: yes # Whether the service should start on boot  